#!/usr/bin/env node
'use strict';

var bundle = require('./src/bundle');

try {
	if (!process.env.INPUT_DIR) { throw new Error('Missing INPUT_DIR environment variable'); }
	if (!process.env.OUTPUT_DIR) { throw new Error('Missing OUTPUT_DIR environment variable'); }
} catch(error) {
	exit(error);
}

var inputPath = process.env.INPUT_DIR;
var outputPath = process.env.OUTPUT_DIR;

log('Loading theme bundle from ' + inputPath);
bundle(inputPath, outputPath, { log: log }, function(error) {
	if (error) { return exit(error); }
	log('Created theme bundle at ' + outputPath);
});

function log(message) {
	process.stdout.write(message + '\n');
}

function exit(error) {
	if (error) {
		process.stderr.write('\u001b[31m' + 'Error: ' + error.message + '\u001b[39m' + '\n');
		process.exit(1);
	} else {
		process.exit();
	}
}
